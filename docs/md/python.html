<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Python User Guide · Perspective</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Perspective for Python uses the exact same C++ data engine used by the"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Python User Guide · Perspective"/><meta property="og:type" content="website"/><meta property="og:url" content="https://perspective.finos.org//index.html"/><meta property="og:description" content="Perspective for Python uses the exact same C++ data engine used by the"/><meta property="og:image" content="https://perspective.finos.org/img/perspective.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://perspective.finos.org/img/perspective.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Public+Sans"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="js/index.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="Perspective"/><h2 class="headerTitleWithLogo">Perspective</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/md/js.html" target="_self">Docs</a></li><li class=""><a href="https://github.com/finos/perspective/" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/md/js.html">JavaScript User Guide</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/md/python.html">Python User Guide</a></li><li class="navListItem"><a class="navItem" href="/docs/md/table.html">Table</a></li><li class="navListItem"><a class="navItem" href="/docs/md/view.html">View</a></li><li class="navListItem"><a class="navItem" href="/docs/md/server.html">Data Binding</a></li><li class="navListItem"><a class="navItem" href="/docs/md/development.html">Developer Guide</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Python User Guide</h1></header><article><div><span><p>Perspective for Python uses the exact same C++ data engine used by the
<a href="https://perspective.finos.org/docs/md/js.html">WebAssembly version</a>. The
library consists of many of the same abstractions and API as in JavaScript,
as well as Python-specific data loading support for <a href="https://numpy.org/">NumPy</a>,
<a href="https://pandas.pydata.org/">Pandas</a> (and
<a href="https://arrow.apache.org/">Apache Arrow</a>, as in JavaScript).</p>
<p>Additionally, <code>perspective-python</code> provides a session manager suitable for
integration into server systems such as
<a href="https://www.tornadoweb.org/en/stable/websocket.html">Tornado websockets</a>, which
allows fully <em>virtual</em> Perspective tables to be interacted with by multiple
<code>&lt;perspective-viewer&gt;</code> in a web browser.</p>
<p>As <code>&lt;perspective-viewer&gt;</code> will only consume the data necessary to render the
current screen, this runtime mode allows <em>ludicrously-sized</em> datasets with
instant-load after they've been manifest on the server (at the expense of
network latency on UI interaction).</p>
<p>The included <code>PerspectiveWidget</code> allows running such a viewer in
<a href="https://jupyterlab.readthedocs.io/en/stable/">JupyterLab</a> in either server or
client (via WebAssembly) mode, and the included <code>PerspectiveTornadoHandler</code>
makes it simple to extend a Tornado server with virtual Perspective support.</p>
<p>The <code>perspective</code> module exports several tools:</p>
<ul>
<li><code>Table</code>, the table constructor for Perspective, which implements the <code>table</code>
and <code>view</code> API in the same manner as the JavaScript library.</li>
<li><code>PerspectiveWidget</code> the JupyterLab widget for interactive visualization.</li>
<li><code>PerspectiveTornadoHandler</code>, an integration with <a href="https://www.tornadoweb.org/">Tornado</a>
that interfaces seamlessly with <code>&lt;perspective-viewer&gt;</code> in JavaScript.</li>
<li><code>PerspectiveManager</code> the session manager for a shared server deployment of
<code>perspective-python</code>.</li>
</ul>
<p>This user's guide provides an overview of the most common ways to use
Perspective in Python: the <code>Table</code> API, the JupyterLab widget, and the Tornado
handler.</p>
<p>For an understanding of Perspective's core concepts, see the
<a href="/docs/md/table.html">Table</a>, <a href="/docs/md/view.html">View</a>, and <a href="/docs/md/server.html">Data Binding</a> documentation. For API documentation, see the
<a href="/docs/obj/perspective-python.html">Python API</a>.</p>
<p><a href="https://github.com/finos/perspective/tree/master/examples">More Examples</a>
are available on GitHub.</p>
<h2><a class="anchor" aria-hidden="true" id="installation"></a><a href="#installation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installation</h2>
<p><code>perspective-python</code> contains full bindings to the Perspective API, a JupyterLab
widget, and a <a href="http://www.tornadoweb.org/en/stable/">Tornado</a> WebSocket handler
that allows you to host Perspective using server-side Python.</p>
<p>In addition to supporting row/columnar formats of data using <code>dict</code> and <code>list</code>,
<code>pandas.DataFrame</code>, dictionaries of NumPy arrays, NumPy structured arrays, and
NumPy record arrays are all supported in <code>perspective-python</code>.</p>
<p><code>perspective-python</code> can be installed from <code>pip</code>:</p>
<pre><code class="hljs css language-bash">pip install perspective-python
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="jupyterlab"></a><a href="#jupyterlab" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Jupyterlab</h3>
<p><code>PerspectiveWidget</code> is a JupyterLab widget that implements the same API as
<code>&lt;perspective-viewer&gt;</code>, allowing for fast, intuitive
transformations/visualizations of various data formats within JupyterLab.</p>
<p><code>PerspectiveWidget</code> is compatible with Jupyterlab 3. To use it, make sure you
have installed <code>perspective-python</code> and then install the extension from the
Jupyter lab extension directory:</p>
<pre><code class="hljs css language-bash">jupyter labextension install @finos/perspective-jupyterlab
</code></pre>
<p>If the widget does not display, you might be missing the <a href="https://ipywidgets.readthedocs.io/en/latest/user_install.html#installing-the-jupyterlab-extension">ipywidgets extension</a>. Install it from the extension directory:</p>
<pre><code class="hljs css language-bash">jupyter labextension install @jupyter-widgets/jupyterlab-manager
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="table"></a><a href="#table" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>Table</code></h2>
<p>A <code>Table</code> can be created from a dataset or a schema, the specifics of which are
<a href="#loading-data-with-table">discussed</a> in the JavaScript section of the user's
guide. In Python, however, Perspective supports additional data types that are
commonly used when processing data:</p>
<ul>
<li><code>pandas.DataFrame</code></li>
<li><code>numpy.ndarray</code></li>
<li><code>bytes</code> (encoding an Apache Arrow)</li>
<li><code>objects</code> (either extracting a repr or via reference)</li>
</ul>
<p>A <code>Table</code> is created in a similar fashion to its JavaScript equivalent:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> date, datetime
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> perspective

data = pd.DataFrame({
    <span class="hljs-string">"int"</span>: np.arange(<span class="hljs-number">100</span>),
    <span class="hljs-string">"float"</span>: [i * <span class="hljs-number">1.5</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>)],
    <span class="hljs-string">"bool"</span>: [<span class="hljs-literal">True</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>)],
    <span class="hljs-string">"date"</span>: [date.today() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>)],
    <span class="hljs-string">"datetime"</span>: [datetime.now() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>)],
    <span class="hljs-string">"string"</span>: [str(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>)]
})

table = perspective.Table(data, index=<span class="hljs-string">"float"</span>)
</code></pre>
<p>Likewise, a <code>View</code> can be created via the <code>view()</code> method:</p>
<pre><code class="hljs css language-python">view = table.view(row_pivots=[<span class="hljs-string">"float"</span>], filter=[[<span class="hljs-string">"bool"</span>, <span class="hljs-string">"=="</span>, <span class="hljs-literal">True</span>]])
column_data = view.to_dict()
row_data = view.to_records()
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="pandas--numpy-support"></a><a href="#pandas--numpy-support" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pandas &amp; Numpy Support</h3>
<p>Perspective supports dictionaries of one-dimensional <code>numpy.ndarray</code>, as well as
structured arrays and record arrays. When passing in dictionaries of NumPy
arrays, make sure that your dataset contains only NumPy arrays, and not a
mixture of arrays and Python lists — this will raise an exception. Numpy
structured/record arrays are parsed according to their field name and dtype.</p>
<p><code>Table</code> can also be constructed from <code>pandas.DataFrame</code> and <code>pandas.Series</code>
objects. Because Perspective is designed for applying its own transformations on
top of a flat dataset, dataframes that are passed in will be flattened and have
its <code>index</code> treated as another column (through the
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.reset_index.html"><code>reset_index()</code></a>
method).</p>
<p>If the dataframe does not have an index set, an integer-typed column
named <code>&quot;index&quot;</code> is created. If you want to preserve the indexing behavior of the
dataframe passed into Perspective, simply create the <code>Table</code> with
<code>index=&quot;index&quot;</code> as a keyword argument. This tells Perspective to once again
treat the index as a primary key:</p>
<pre><code class="hljs css language-python">data.set_index(<span class="hljs-string">"datetime"</span>)
table = perspective.Table(data, index=<span class="hljs-string">"index"</span>)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="schemas--supported-data-types"></a><a href="#schemas--supported-data-types" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Schemas &amp; Supported Data Types</h3>
<p>Unlike JavaScript, where schemas must be created using string representations of
their types, <code>perspective-python</code> leverages Python's type system for schema
creation.  A schema can be created with the following types:</p>
<ul>
<li><code>int</code> (and <code>long</code> in Python 2)</li>
<li><code>float</code></li>
<li><code>bool</code></li>
<li><code>datetime.date</code></li>
<li><code>datetime.datetime</code></li>
<li><code>str</code> (and <code>unicode</code> in Python 2)</li>
<li><code>object</code></li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="loading-custom-objects"></a><a href="#loading-custom-objects" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Loading Custom Objects</h4>
<p>Custom objects can also be loaded into Perspective by using <code>object</code> in the schema, or
implementing <code>_psp_repr_</code> to return <code>object</code>. Perspective stores a reference
to your object as an unsigned 64-bit integer (e.g. a pointer), and uses  <code>__repr__</code>
(or <code>_psp_repr</code> if implemented) to represent the object.</p>
<p>You can customize how Perspective extracts data from your objects by implementing these
two methods into your object:</p>
<ul>
<li><code>_psp_repr_</code>: Since <code>__repr__</code> can only return strings, this lets you return other values</li>
<li><code>_psp_dtype_</code>: Perpspective will look at this to determine how to cast your objects' repr.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="time-zone-handling"></a><a href="#time-zone-handling" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Time Zone Handling</h4>
<ul>
<li><a href="https://docs.python.org/3/library/datetime.html#aware-and-naive-objects">&quot;Naive&quot;</a>
datetimes are assumed to be local time.</li>
<li><a href="https://docs.python.org/3/library/datetime.html#aware-and-naive-objects">&quot;Aware&quot;</a>
datetimes use the time zone specified in the <code>tzinfo</code>.</li>
</ul>
<p>All <code>datetime</code> columns (regardless of input time zone) are output to the user as
<code>datetime.datetime</code> objects in <em>local time</em> according to the Python runtime.</p>
<p>This behavior is consistent with Perspective's behavior in JavaScript. For more
details, see this in-depth <a href="https://github.com/finos/perspective/pull/867">explanation</a>
of <code>perspective-python</code> semantics around time zone handling.</p>
<h5><a class="anchor" aria-hidden="true" id="pandas-timestamps"></a><a href="#pandas-timestamps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pandas Timestamps</h5>
<ul>
<li>Naive <code>pandas.Timestamp</code> objects are <em>always</em> treated as UTC times, and will
be converted to local time when output to the user.</li>
<li>Aware <code>pandas.Timestamp</code> objects use the time zone specified in <code>tzinfo</code>. Use
<code>tz_localize</code> or <code>tz_convert</code> to provide the <code>Timestamp</code> with a time zone.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="callbacks-and-events"></a><a href="#callbacks-and-events" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Callbacks and Events</h3>
<p><code>perspective.Table</code> allows for <code>on_update</code> and <code>on_delete</code> callbacks to be
set—simply call <code>on_update</code> or <code>on_delete</code> with a reference to a function or a
lambda without any parameters:</p>
<pre><code class="hljs css language-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update_callback</span><span class="hljs-params">()</span>:</span>
    print(<span class="hljs-string">"Updated!"</span>)

<span class="hljs-comment"># set the update callback</span>
view.on_update(update_callback)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete_callback</span><span class="hljs-params">()</span>:</span>
    print(<span class="hljs-string">"Deleted!"</span>)

<span class="hljs-comment"># set the delete callback</span>
view.on_delete(delete_callback)

<span class="hljs-comment"># set a lambda as a callback</span>
view.on_delete(<span class="hljs-keyword">lambda</span>: print(<span class="hljs-string">"Deleted x2!"</span>))
</code></pre>
<p>If the callback is a named reference to a function, it can be removed with
<code>remove_update</code> or <code>remove_delete</code>:</p>
<pre><code class="hljs css language-python">view.remove_update(update_callback)
view.remove_delete(delete_callback)
</code></pre>
<p>Callbacks defined with a lambda function cannot be removed, as lambda functions
have no identifier.</p>
<h2><a class="anchor" aria-hidden="true" id="perspectivemanager"></a><a href="#perspectivemanager" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>PerspectiveManager</code></h2>
<p><code>PerspectiveManager</code> offers an interface for hosting multiple
<code>perspective.Table</code> and <code>perspective.View</code> instances, extending their
interfaces to operate with the <a href="/docs/md/js.html">JavaScript library</a> over a
websocket connection.  <code>PerspectiveManager</code> is required to enable
<code>perspective-python</code> to
<a href="/docs/md/js.html#remote-perspective-via-perspective-python-and-tornado">operate remotely</a>
using a websocket API.</p>
<h3><a class="anchor" aria-hidden="true" id="async-mode"></a><a href="#async-mode" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Async Mode</h3>
<p>By default, <code>perspective</code> will run with a synchronous interface.  Using the
<code>PerspectiveManager.set_loop_callback()</code> method, <code>perspective</code> can be configured
to defer the application of side-effectful calls like <code>update()</code> to an event
loop, such as <code>tornado.ioloop.IOLoop</code>.  When running in Async mode, Perspective
will release the GIL for some operations, enabling better parallelism and
overall better server performance.  There are a few important differences when
running <code>PerspectiveManager</code> in this mode:</p>
<ul>
<li>Calls to methods like <code>update()</code> will return immediately, and the reciprocal
<code>on_update()</code> callbacks will be invoked on an event later scheduled.  Calls
to other methods which require an up-to-date object, but will still
synchronously apply the pending update.</li>
<li>Updates will be <em>conflated</em> when multiple calls to <code>update()</code> occur before
the scheduled application.  In such cases, you may receive a single
<code>on_update()</code> notification for multiple <code>update()</code> calls.</li>
<li>Once <code>set_loop_callback()</code> has been called, you may not call Perspective
functions from any other thread.</li>
</ul>
<p>For example, using Tornado <code>IOLoop</code> you can create a dedicated thread for a
<code>PerspectiveManager</code>:</p>
<pre><code class="hljs css language-python">manager = perspective.PerspectiveManager()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">perspective_thread</span><span class="hljs-params">()</span>:</span>
    loop = tornado.ioloop.IOLoop()
    manager.set_loop_callback(loop.add_callback)
    loop.start()

thread = threading.Thread(target=perspective_thread)
thread.daemon = <span class="hljs-literal">True</span>
thread.start()
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="hosting-table-and-view-instances"></a><a href="#hosting-table-and-view-instances" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hosting <code>Table</code> and <code>View</code> instances</h3>
<p><code>PerspectiveManager</code> has the ability to &quot;host&quot; <code>perspective.Table</code> and
<code>perspective.View</code> instances. Hosted tables/views can have their methods
called from other sources than the Python server, i.e. by a <code>perspective-viewer</code> running
in a JavaScript client over the network, interfacing with <code>perspective-python</code> through
the websocket API.</p>
<p>The server has full control of all hosted <code>Table</code> and <code>View</code>
instances, and can call any public API method on hosted instances. This makes
it extremely easy to stream data to a hosted <code>Table</code> using <code>.update()</code>:</p>
<pre><code class="hljs css language-python">manager = PerspectiveManager()
table = Table(data)
manager.host_table(<span class="hljs-string">"data_source"</span>, table)

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):
    <span class="hljs-comment"># updates continue to propagate automatically</span>
    table.update(new_data)
</code></pre>
<p>In situations where clients should only be able to view the table and
not modify it through <code>update</code>, <code>delete</code>, etc., initialize the <code>PerspectiveManager</code>
with <code>lock=True</code>, or call the <code>lock()</code> method on a manager instance:</p>
<pre><code class="hljs css language-python"><span class="hljs-comment"># lock prevents clients from calling methods that may mutate the state</span>
<span class="hljs-comment"># of the table.</span>
manager = PerspectiveManager(lock=<span class="hljs-literal">True</span>)
table = Table(data)
manager.host_table(<span class="hljs-string">"data_source"</span>, table)
</code></pre>
<p>A <code>PerspectiveManager</code> instance can host as many <code>Table</code>s and <code>View</code>s as
necessary, but each <code>Table</code> should only be hosted by <em>one</em> <code>PerspectiveManager</code>.</p>
<p>To host a <code>Table</code> or a <code>View</code>, call the corresponding method on an instance
of <code>PerspectiveManager</code> with a string name and the instance to be hosted:</p>
<pre><code class="hljs css language-python">manager = PerspectiveManager()
table = Table(data)
manager.host_table(<span class="hljs-string">"data_source"</span>, table)
</code></pre>
<p>The <code>name</code> provided is important, as it enables Perspective in JavaScript to look
up a <code>Table</code> and get a handle to it over the network. This enables
several powerful server/client implementations of Perspective, as explained in
the next section.</p>
<h3><a class="anchor" aria-hidden="true" id="clientserver-replicated-mode"></a><a href="#clientserver-replicated-mode" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Client/Server Replicated Mode</h3>
<p>Using Tornado and <a href="/docs/md/python.html#perspectivetornadohandler"><code>PerspectiveTornadoHandler</code></a>,
as well as <code>Perspective</code>'s JavaScript library, we can set up &quot;distributed&quot;
Perspective instances that allows multiple browser <code>perspective-viewer</code>
clients to read from a common <code>perspective-python</code> server, as in the
<a href="https://github.com/finos/perspective/tree/master/examples/tornado-python">Tornado Example Project</a>.</p>
<p>This architecture works by maintaining two <code>Tables</code>—one on the server, and one
on the client that mirrors the server's <code>Table</code> automatically using <code>on_update</code>.
All updates to the table on the server are automatically applied to each client,
which makes this architecture a natural fit for streaming dashboards and other
distributed use-cases.  In conjunction with <a href="#async-mode">Async Mode</a>, distributed Perspective offers consistently high performance over large numbers of clients
and large datasets.</p>
<p><em><em>server.py</em></em></p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> perspective <span class="hljs-keyword">import</span> Table, PerspectiveManager, PerspectiveTornadoHandler

<span class="hljs-comment"># Create an instance of PerspectiveManager, and host a Table</span>
MANAGER = PerspectiveManager()
TABLE = Table(data)

<span class="hljs-comment"># The Table is exposed at `localhost:8888/websocket` with the name `data_source`</span>
MANAGER.host_table(<span class="hljs-string">"data_source"</span>, TABLE)

app = tornado.web.Application([
    (<span class="hljs-string">r"/"</span>, MainHandler),
    <span class="hljs-comment"># create a websocket endpoint that the client JavaScript can access</span>
    (<span class="hljs-string">r"/websocket"</span>, PerspectiveTornadoHandler, {<span class="hljs-string">"manager"</span>: MANAGER, <span class="hljs-string">"check_origin"</span>: <span class="hljs-literal">True</span>})
])

<span class="hljs-comment"># Start the Tornado server</span>
app.listen(<span class="hljs-number">8888</span>)
loop = tornado.ioloop.IOLoop.current()
loop.start()
</code></pre>
<p>Instead of calling <code>load(server_table)</code>, create a <code>View</code> using <code>server_table</code>
and pass that into <code>viewer.load()</code>. This will automatically register an
<code>on_update</code> callback that synchronizes state between the server and the client.</p>
<p><em><em>index.html</em></em></p>
<pre><code class="hljs css language-html"><span class="hljs-tag">&lt;<span class="hljs-name">perspective-viewer</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"viewer"</span> <span class="hljs-attr">editable</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">perspective-viewer</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">"DOMContentLoaded"</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// Create a client that expects a Perspective server</span>
    <span class="hljs-comment">// to accept connections at the specified URL.</span>
    <span class="hljs-keyword">const</span> websocket = perspective.websocket(<span class="hljs-string">"ws://localhost:8888/websocket"</span>);

    <span class="hljs-comment">// Get a handle to the Table on the server</span>
    <span class="hljs-keyword">const</span> server_table = websocket.open_table(<span class="hljs-string">"data_source_one"</span>);

    <span class="hljs-comment">// Create a new view</span>
    <span class="hljs-keyword">const</span> server_view = <span class="hljs-keyword">await</span> table.view();

    <span class="hljs-comment">// Create a Table on the client using `perspective.worker()`</span>
    <span class="hljs-keyword">const</span> worker = perspective.worker();
    <span class="hljs-keyword">const</span> client_table = <span class="hljs-keyword">await</span> worker.table(view);

    <span class="hljs-comment">// Load the client table in the `&lt;perspective-viewer&gt;`.</span>
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"viewer"</span>).load(client_table);
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>For a more complex example that offers distributed editing of the server
dataset, see <a href="https://github.com/finos/perspective/blob/master/examples/tornado-python/client_server_editing.html">client_server_editing.html</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="server-only-mode"></a><a href="#server-only-mode" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Server-only Mode</h3>
<p>The server setup is identical to <a href="#distributed-mode">Distributed Mode</a> above,
but instead of creating a view, the client calls <code>load(server_table)</code>:
In Python, use <code>PerspectiveManager</code> and <code>PerspectiveTornadoHandler</code> to create
a websocket server that exposes a <code>Table</code>.  In this example, <code>table</code> is a proxy
for the <code>Table</code> we created on the server.  All API methods are available on
<em>proxies</em>, the.g.us calling <code>view()</code>, <code>schema()</code>, <code>update()</code>  on <code>table</code> will
pass those operations to the Python <code>Table</code>, execute the commands, and return
the result back to Javascript.</p>
<pre><code class="hljs css language-html"><span class="hljs-tag">&lt;<span class="hljs-name">perspective-viewer</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"viewer"</span> <span class="hljs-attr">editable</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">perspective-viewer</span>&gt;</span>
</code></pre>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">const</span> websocket = perspective.websocket(<span class="hljs-string">"ws://localhost:8888/websocket"</span>);
<span class="hljs-keyword">const</span> table = websocket.open_table(<span class="hljs-string">"data_source_one"</span>);
<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"viewer"</span>).load(table);
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="perspectivewidget"></a><a href="#perspectivewidget" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>PerspectiveWidget</code></h2>
<p>Building on top of the API provided by <code>perspective.Table</code>, the
<code>PerspectiveWidget</code> is a JupyterLab plugin that offers the entire functionality
of Perspective within the Jupyter environment. It supports the same API
semantics of <code>&lt;perspective-viewer&gt;</code>, along with the additional data types
supported by <code>perspective.Table</code>.   <code>PerspectiveWidget</code> takes keyword arguments
for the managed <code>View</code>;  additioanl arguments <code>index</code> and <code>limit</code>  will be
passed to the <code>Table</code>.  For convenience are the <a href="https://github.com/finos/perspective/blob/master/python/perspective/perspective/core/aggregate.py"><code>Aggregate</code></a>,
<a href="https://github.com/finos/perspective/blob/master/python/perspective/perspective/core/sort.py"><code>Sort</code></a>,
and
<a href="https://github.com/finos/perspective/blob/master/python/perspective/perspective/core/plugin.py"><code>Plugin</code></a>
enums, which can be used as replacements to string values in the API:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> perspective <span class="hljs-keyword">import</span> PerspectiveWidget, Aggregate, Sort, Plugin
w = perspective.PerspectiveWidget(
    data,
    plugin=Plugin.XBAR, 
    aggregates={<span class="hljs-string">"datetime"</span>: Aggregate.ANY},
    sort=[[<span class="hljs-string">"date"</span>, Sort.DESC]]
)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="creating-a-widget"></a><a href="#creating-a-widget" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a widget</h3>
<p>A widget is created through the <code>PerspectiveWidget</code> constructor, which takes as
its first, required parameter a <code>perspective.Table</code>, a dataset, a schema, or
<code>None</code>, which serves as a special value that tells the Widget to defer loading
any data until later. In maintaining consistency with the Javascript API,
Widgets cannot be created with empty dictionaries or lists—<code>None</code> should be used
if the intention is to await data for loading later on.  A widget can be
constructed from a dataset:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> perspective <span class="hljs-keyword">import</span> PerspectiveWidget, Table
PerspectiveWidget(data, row_pivots=[<span class="hljs-string">"date"</span>])
</code></pre>
<p>.. or a schema:</p>
<pre><code class="hljs css language-python">PerspectiveWidget({<span class="hljs-string">"a"</span>: int, <span class="hljs-string">"b"</span>: str})
</code></pre>
<p>.. or an instance of a <code>perspective.Table</code>:</p>
<pre><code class="hljs css language-python">table = Table(data)
PerspectiveWidget(table)
</code></pre>
<p>.. or <code>None</code>:</p>
<pre><code class="hljs css language-python">PerspectiveWidget(<span class="hljs-literal">None</span>)
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="perspectiverenderer"></a><a href="#perspectiverenderer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>PerspectiveRenderer</code></h2>
<p>Perspective also exposes a JS-only <code>mimerender-extension</code>. This lets you view <code>csv</code>, <code>json</code>, and <code>arrow</code> files directly from the file browser. You can see this by right clicking one of these files and <code>Open With-&gt;CSVPerspective</code> (or <code>JSONPerspective</code> or <code>ArrowPerspective</code>). Perspective will also install itself as the default handler for opening <code>.arrow</code> files.</p>
<h2><a class="anchor" aria-hidden="true" id="perspectivetornadohandler"></a><a href="#perspectivetornadohandler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>PerspectiveTornadoHandler</code></h2>
<p>Perspective ships with a pre-built Tornado handler that makes integration with
<code>tornado.websockets</code> extremely easy. This allows you to run an instance of
<code>Perspective</code> on a server using Python, open a websocket to a <code>Table</code>, and
access the <code>Table</code> in JavaScript and through <code>&lt;perspective-viewer&gt;</code>.  All
instructions sent to the <code>Table</code> are processed in Python, which executes the
commands, and returns its output through the websocket back to Javascript.</p>
<h3><a class="anchor" aria-hidden="true" id="python-setup"></a><a href="#python-setup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Python setup</h3>
<p>To use the handler, we need to first have an instance of a <code>Table</code> and a
<code>PerspectiveManager</code>. The manager acts as the interface between the JavaScript
and Python layers, implementing a JSON API that allows the two Perspective
runtimes to communicate.</p>
<pre><code class="hljs css language-python">MANAGER = PerspectiveManager()
</code></pre>
<p>Once the manager has been created, create a <code>Table</code> instance and call
<code>host_table</code> on the manager with a name, passing through a reference to the
<code>Table</code> you just created. <code>host_table()</code> registers the Table with the manager
and allows the manager to send instructions to the Table.</p>
<p>The name that you host the table under is important—it acts as a unique accessor
on the JavaScript side, which will look for a Table hosted at the websocket with
the name you specify.</p>
<pre><code class="hljs css language-python">TABLE = Table(data)
MANAGER.host_table(<span class="hljs-string">"data_source_one"</span>, TABLE)
</code></pre>
<p>After the manager and table setup is complete, create a websocket endpoint and
provide it a reference to <code>PerspectiveTornadoHandler</code>. You must provide the
configuration object in the route tuple, and it must contain <code>manager</code>, which is
a reference to the <code>PerspectiveManager</code> you just created.</p>
<pre><code class="hljs css language-python">app = tornado.web.Application([
    (<span class="hljs-string">r"/"</span>, MainHandler),
    <span class="hljs-comment"># create a websocket endpoint that the client JavaScript can access</span>
    (<span class="hljs-string">r"/websocket"</span>, PerspectiveTornadoHandler, {<span class="hljs-string">"manager"</span>: MANAGER, <span class="hljs-string">"check_origin"</span>: <span class="hljs-literal">True</span>})
])
</code></pre>
<p>Optionally, the configuration object can also include <code>check_origin</code>, a boolean
that determines whether the websocket accepts requests from origins other than
where the server is hosted. See
<a href="https://www.tornadoweb.org/en/stable/websocket.html#tornado.websocket.WebSocketHandler.check_origin">Tornado docs</a>
for more details.</p>
<h3><a class="anchor" aria-hidden="true" id="javascript-setup"></a><a href="#javascript-setup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JavaScript setup</h3>
<p>Once the server is up and running, you can access the Table you just hosted
using <code>perspective.websocket</code> and <code>open_table()</code>. First, create a client that
expects a Perspective server to accept connections at the specified URL:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">const</span> websocket = perspective.websocket(<span class="hljs-string">"ws://localhost:8888/websocket"</span>);
</code></pre>
<p>Next open the <code>Table</code> we created on the server by name:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">const</span> table = websocket.open_table(<span class="hljs-string">"data_source_one"</span>);
</code></pre>
<p><code>table</code> is a proxy for the <code>Table</code> we created on the server. All operations that
are possible through the JavaScript API are possible on the Python API as well,
thus calling <code>view()</code>, <code>schema()</code>, <code>update()</code> etc. on <code>const table</code> will pass
those operations to the Python <code>Table</code>, execute the commands, and return the
result back to JavaScript. Similarly, providing this <code>table</code> to a
<code>&lt;perspective-viewer&gt;</code> instance will allow virtual rendering:</p>
<pre><code class="hljs css language-javascript">viewer.load(table);
</code></pre>
<p><code>perspective.websocket</code> expects a Websocket URL where it will send instructions.
When <code>open_table</code> is called, the name to a hosted Table is passed through, and a
request is sent through the socket to fetch the Table. No actual <code>Table</code> instance
is passed inbetween the runtimes; all instructions are proxied through
websockets.</p>
<p>This provides for great flexibility — while <code>Perspective.js</code> is full of
features, browser WebAssembly runtimes currently have some performance
restrictions on memory and CPU feature utilization, and the architecture in
general suffers when the dataset itself is too large to download to the client
in full.</p>
<p>The Python runtime does not suffer from memory limitations, utilizes
<a href="https://github.com/intel/tbb">TBB</a> for threading and parallel processing, and
generates architecture optimized code, which currently makes it more suitable as
a server-side runtime than <code>node.js</code>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/md/js.html"><span class="arrow-prev">← </span><span class="function-name-prevnext">JavaScript User Guide</span></a><a class="docs-next button" href="/docs/md/table.html"><span>Table</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#installation">Installation</a><ul class="toc-headings"><li><a href="#jupyterlab">Jupyterlab</a></li></ul></li><li><a href="#table"><code>Table</code></a><ul class="toc-headings"><li><a href="#pandas--numpy-support">Pandas &amp; Numpy Support</a></li><li><a href="#schemas--supported-data-types">Schemas &amp; Supported Data Types</a></li><li><a href="#callbacks-and-events">Callbacks and Events</a></li></ul></li><li><a href="#perspectivemanager"><code>PerspectiveManager</code></a><ul class="toc-headings"><li><a href="#async-mode">Async Mode</a></li><li><a href="#hosting-table-and-view-instances">Hosting <code>Table</code> and <code>View</code> instances</a></li><li><a href="#clientserver-replicated-mode">Client/Server Replicated Mode</a></li><li><a href="#server-only-mode">Server-only Mode</a></li></ul></li><li><a href="#perspectivewidget"><code>PerspectiveWidget</code></a><ul class="toc-headings"><li><a href="#creating-a-widget">Creating a widget</a></li></ul></li><li><a href="#perspectiverenderer"><code>PerspectiveRenderer</code></a></li><li><a href="#perspectivetornadohandler"><code>PerspectiveTornadoHandler</code></a><ul class="toc-headings"><li><a href="#python-setup">Python setup</a></li><li><a href="#javascript-setup">JavaScript setup</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"></a><div><h5>Docs</h5><a href="/docs/md/js.html">Javascript User Guide</a><a href="/docs/md/python.html">Python User Guide</a><a href="/docs/obj/perspective.html">Perspective API</a><a href="/docs/obj/perspective-viewer.html">Perspective Viewer API</a><a href="/docs/obj/perspective-python-table.html">Perspective Python API</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/finos/perspective/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2021 Perspective Authors</section></footer></div></body></html>